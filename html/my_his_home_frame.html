<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>ÊàëÁöÑ</title>
    <link rel="stylesheet" type="text/css" href="../css/aui.css"/>
    <link rel="stylesheet" type="text/css" href="../css/alifont/iconfont.css"/>
    <style type="text/css">
        .text-white {
            color: #ffffff !important;
        }

        .bg-white {
            background-color: #ffffff;
        }

        .aui-grid [class*=aui-col-] {
            padding: 0;
        }

        .user-info {
            width: 150%;
            position: relative;
            left: -25%;
            padding-left: 25%;
            border-bottom-left-radius: 50%;
            border-bottom-right-radius: 50%;
            padding-bottom: 1.5rem;
        }

        .aui-grid .aui-dot {
            top: 0rem;
        }

        .label-cont .aui-iconfont {
            font-size: 1rem;
        }

        .label-icon .aui-iconfont {
            color: #ffffff;
            font-size: 0.8rem;
        }
        .delete-btn {
            position: absolute;
            left: 50%;
            top: 50%;
            width: 40px;
            height: 40px;
            /*background-color: rgba(0, 0, 0, 0.7);*/
            margin-left: -20px;
            margin-top: -20px;
            color: #ffffff;
            text-align: center;
            vertical-align: middle;
            /*border-radius: 50%;*/
        }


    </style>
</head>
<body>
<div id="app">
    <!--=================‰∏äÈÉ®ÂàÜ===================-->
    <section >
        <div class="aui-card-list-content" >
            <div class="aui-list aui-list-noborder aui-media-list my-bgc" style="border-top: none !important;">
                <div class="aui-list-item aui-list-item-middle">
                    <div class="aui-media-list-item-inner">
                        <div class="aui-list-item-media">
                            <img :src="my_head" class="aui-img-round aui-list-img-sm">
                        </div>
                        <div class="aui-list-item-inner" >
                            <div class="aui-list-item-text">
                                <div class="aui-list-item-title aui-font-size-18 text-white">{{my_nick}}</div>
                                <div v-if="follow !== 2">
                                    <div v-if="follow == 1" class="aui-list-item-right text-white aui-btn aui-btn-default" onclick="off_follow()">Â∑≤ÂÖ≥Ê≥®</div>
                                    <div v-if="follow == 0" class="aui-list-item-right text-white aui-btn aui-btn-warning" onclick="to_follow()">ÂÖ≥Ê≥®</div>
                                    <div class="aui-list-item-right text-white aui-btn aui-btn-primary" v-on:click="open_chat()">ÁßÅ‰ø°</div>
                                </div>
                            </div>

                            <div class="aui-list-item-text text-white aui-margin-t-15">Â≠¶Ê†°Ôºö{{my_school}}</div>
                            <div v-if="my_gender == 'female'" class="aui-list-item-text text-white">ÊÄßÂà´Ôºöüëóüë†</div>
                            <div v-else class="aui-list-item-text text-white">ÊÄßÂà´Ôºöüëîüëñ</div>
                            <div v-if=" my_sign " class="aui-list-item-text text-white">
                                <div>Á≠æÂêçÔºö{{my_sign}}</div>
                            </div>
                            <div v-else class="aui-list-item-text text-white">
                                <div>Á≠æÂêçÔºöÊàëËøòÊ≤°Êù•ÂæóÂèäÂÜôÁ≠æÂêçÂë¢~</div>
                            </div>
                            <br>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="aui-content aui-grid aui-margin-b-15 aui-margin-t-15">
        <div class="aui-row">
            <div class="aui-col-xs-4 aui-border-r">
                <div class="aui-text-primary">{{good_num}}
                    <small></small>
                </div>
                <div class="aui-gird-lable aui-font-size-12">Ëé∑ÂñúÊ¨¢</div>
            </div>
            <div class="aui-col-xs-4 aui-border-r">
                <div class="aui-text-success">{{comment_num}}
                    <small></small>
                </div>
                <div class="aui-gird-lable aui-font-size-12">Ëé∑ËØÑËÆ∫</div>
            </div>
            <div class="aui-col-xs-4 aui-border-r">
                <div class="aui-text-info">{{fan_num}}
                    <small></small>
                </div>
                <div class="aui-gird-lable aui-font-size-12">Ëé∑Á≤â‰∏ù</div>
            </div>
        </div>
    </section>

    <section v-if="find_list">
    <!--================================================ ÂèëÁé∞ Âæ™ÁéØ =========================================-->
        <ul class="aui-list aui-media-list">
        <li class="aui-list-item" style="border-bottom: 1px solid #dddddd;"
            v-for="item in find_list">
            <div class="aui-card-list-header aui-card-list-user"
                 style="padding: 10px 18px 5px 3px; border-bottom: none">
                <div class="aui-card-list-user-avatar">
                    <img :src="qiniu + item.for_text[0].u_img + qiniu_small" class="aui-img-round my-img-size"/>
                </div>
                <div class="aui-card-list-user-name">
                    <div>{{item.for_text[0].u_nick}}</div>
                </div>

                <div v-if="item.for_text[0].publish_date === day_date" class="aui-card-list-user-info">
                    {{item.for_text[0].publish_time | filter_d}}
                </div>
                <div v-else class="aui-card-list-user-info">
                    {{item.for_text[0].publish_date}} {{item.for_text[0].publish_time | filter_d}}
                </div>

            </div>

            <div class="aui-media-list-item-inner">
                <div class="aui-list-item-inner">
                    <!---==============ÊñáÊú¨=================-->
<!--ÈúÄË¶ÅÈ°∂Â§¥ÂÜôÔºå‰∏çÁÑ∂white-space:pre-wrap;‰ºöÊääÂâçÈù¢ÁöÑÁ©∫Ê†ºÈ°µÂΩì‰ΩúÁ©∫Ê†ºÊòæÁ§∫Âá∫Êù•-->
<span v-on:click="open_find_content( item.for_text[0].id, item.for_good, item.for_text[0].u_id)" style="color:#333;font-size: 16px;white-space:pre-wrap;">{{item.for_text[0].content}}</span>
                    <!--=============ÂõæÁâá=================-->
                    <div v-if=" item.for_img.length ">
                        <div class="aui-list-item-text"
                             v-if=" item.for_img.length === 1 || item.for_img.length === 2 || item.for_img.length === 4">
                            <div class="aui-row-padded" style="max-width:100%;">
                                <div class="aui-col-xs-6" v-for="(img, index) in item.for_img">
                                    <img :src="qiniu + img.qiniu_img + qiniu_big"
                                         v-on:click="open_img_big( item.for_img, index )"/>
                                </div>
                            </div>
                        </div>

                        <div class="aui-list-item-text" v-else>
                            <div class="aui-row-padded" style="max-width:100%;">
                                <div class="aui-col-xs-4" v-for="(img, index) in item.for_img">
                                    <img :src="qiniu + img.qiniu_img + qiniu_small"
                                         v-on:click="open_img_big( item.for_img, index )"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--==============ÂΩïÈü≥================-->
                    <div class="aui-grid" v-if="item.for_voice.length">
                        <div class="aui-row">

                            <div class="aui-col-xs-4" style="float: left">
                                <i style="color: #1E90FF; font-size: 26px" class="aui-iconfont iconfont icon-yuyin"></i>
                                <span style="font-size: 14px;color: #9e9e9e;padding-top: 4px;">
                                    &nbsp;&nbsp;{{item.for_voice[0].voice_time}}&nbsp;s
                                </span>
                            </div>

                            <div class="aui-col-xs-4"
                                 v-on:click="paly_audio( item.for_voice[0].qiniu_voice , item.for_voice[0].id)">
                                <i v-if="true_id_voice ===  item.for_voice[0].id"
                                   style="color: #1E90FF;font-size: 28px"
                                   class=" aui-iconfont iconfont icon-bofangzhong1"></i>
                                <i v-else
                                   style="color: #1E90FF;font-size: 28px" class=" aui-iconfont iconfont icon-2play"></i>
                            </div>

                            <div class="aui-col-xs-4" v-on:click.stop="stop_voice()"
                                 v-if=" true_id_voice ===  item.for_voice[0].id ">
                                <i style="color: #df5000;font-size: 28px"
                                   class="aui-iconfont iconfont icon-tingzhi2"></i>
                            </div>

                        </div>
                    </div>

                    <!--==============ËßÜÈ¢ë================-->
                    <div v-if="item.for_video.length">
                        <div class="aui-list-item-text">
                            <div class="aui-row-padded" style="max-width:100%;">
                                <div class="aui-col-xs-6" v-on:click="play_video( item.for_video[0].qiniu_video )">
                                    <img :src="qiniu + item.for_video[0].qiniu_video + qiniu_video_img"/>
                                    <div class="delete-btn">
                                        <i style="font-size: 25px" class="aui-iconfont iconfont icon-shipin3"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--================Ê†áÁ≠æ===========================-->
                    <div v-if="item.for_text[0].tag" style="margin-top: 5px;padding-top: 5px;color:#1874CD;">
                        #{{item.for_text[0].tag}}#
                    </div>

                    <!--================‰∏âÂ§ßÈáëÂàöÈîÆ===========================-->
                    <div class="aui-card-list-footer" style="margin-top: 12px;padding-top: 12px;font-size: 16px"
                         v-on:click="open_find_content( item.for_text[0].id , item.for_good, item.for_text[0].u_id)">
                        <div>
                            <i class="aui-iconfont iconfont icon-liulan1"></i>
                            {{item.for_text[0].view_num}}
                        </div>
                        <div>
                            <i class="aui-iconfont iconfont icon-pinglun"></i>
                            {{item.for_text[0].comment_num}}
                        </div>
                        <div>
                            <i v-if=" item.for_good " style="color: #ff558c"
                               class="aui-iconfont iconfont icon-zan1"></i>
                            <i v-else  class="aui-iconfont iconfont icon-zan"></i>
                             {{item.for_text[0].good_num}}
                        </div>
                    </div>

                </div>
            </div>
        </li>

    </ul>
</section>

</div>
</body>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/vue.js"></script>

<script type="text/javascript">

    var photoBrowser;
    var dialogBox;
    var moviePlayer;


    // ÂêØÂä®ÊâßË°å‰∫ã‰ª∂
    apiready = function () {

        vm.user_id = api.pageParam.user_id;

        vm.init(true);
        initRefresh();  // ‰∏ãÊãâÂà∑Êñ∞

        photoBrowser = api.require('photoBrowser');  //ÁÖßÁâáÊü•ÁúãÂô®
        dialogBox = api.require('dialogBox');    //ÂºπÂá∫ actionMenu Ê†∑ÂºèÁöÑÂØπËØùÊ°Ü
        moviePlayer = api.require('moviePlayer');   //ËßÜÈ¢ëÊí≠ÊîæÂô®

        //‰∏ãÊãâÁõëÂê¨‰∫ã‰ª∂
        api.addEventListener({
            name : 'scrolltobottom',
            extra : {
                threshold : 0 //ËÆæÁΩÆË∑ùÁ¶ªÂ∫ïÈÉ®Â§öÂ∞ëË∑ùÁ¶ªÊó∂Ëß¶ÂèëÔºåÈªòËÆ§ÂÄº‰∏∫0ÔºåÊï∞Â≠óÁ±ªÂûã
            }
        }, function(ret, err) {
            //ÂàÜÈ°µÂä†10ÔºåÂíåÂêéÂè∞ÂêåÊ≠•
            vm.skip += 10;
            vm.init(false);
        });
    };


    // vueÂÆû‰æã
    var vm = new Vue({
        el: '#app',
        data: {
            day_date: my_date(),
            user_id:'',

            media: media_url,
            qiniu: qiniu_url,
            qiniu_small: qiniu_small,
            qiniu_big: qiniu_big,
            qiniu_video_img: qiniu_video_img,

            user_msg: [],
            my_nick:'',
            my_head:'',
            my_school:'',
            my_gender:'',
            my_sign:'',

            fan_num: '',
            good_num: '',
            comment_num: '',
            follow: '',

            find_list: [],  //ÊâÄÊúâÊï∞ÊçÆ

            one_img_list: [],  //Âçï‰∏™Á∫ØÂõæÁâáurlÂàóË°®
            one_img: '',       //Âçï‰∏™Á∫ØÂõæÁâáurl
            one_img_index: '',  //ÂõæÁâáÁ¥¢Âºï

            play_s: 'Êí≠Êîæ',
            one_voice: '',
            voice_url: '',
            true_id_voice: 0,//ÁúüÂÆûid ÊòæÁ§∫Ê†áËØÜ

            one_video: '',

            is_more: true,    //Âä†ËΩΩÊõ¥Â§ö,ÈªòËÆ§Á¨¨‰∏ÄÊ¨°
            skip: 0,
        },
        methods: {
            //ÂàùÂßãÂåñ ajaxÊï∞ÊçÆËØ∑Ê±Ç
            init: function (more_) {
                api.ajax({
                    url: his_home_page + '?user_id=' + vm.user_id + '&my_id=' + $api.getStorage('uid') + '&skip=' + vm.skip,
                    method: 'get',
                    cache: 'true',
                    timeout: 30,
                    dataType: 'json',
                    returnAll: false,
                }, function (ret, err) {
                    if (ret) {
                        api.refreshHeaderLoadDone(); //ÊñπÊ≥ïÊÅ¢Â§çÁªÑ‰ª∂Âà∞ÈªòËÆ§Áä∂ÊÄÅ
                        if (ret.code === 200) {
                            vm.user_msg = ret.user_list;
                            vm.my_nick = ret.user_list[0].nick;
                            vm.my_head = vm.qiniu + ret.user_list[0].head_qn_url + '?imageView2/1/w/150/h/150/q/100|imageslim';
                            vm.my_school = ret.user_list[0].school_name;
                            vm.my_sign = ret.user_list[0].my_sign;
                            vm.my_gender = ret.user_list[0].gender;
                            vm.follow = ret.follow;

                            // ËøôÊòØsumÊñπÂºè
                            // vm.fan_num = ret.fans_num.user__count;
                            // vm.good_num = ret.moment_msg.good_num__sum;
                            // vm.comment_num = ret.moment_msg.comment_num__sum;
                            // ËøôÊòØÊØèÊ¨°Âè†Âä†ÊñπÂºè
                            vm.fan_num = ret.num_num[0].fans_total;
                            vm.good_num = ret.num_num[0].good_total;
                            vm.comment_num = ret.num_num[0].comment_total;

                            if ( more_ ){
                                vm.find_list = ret.all_list;
                            } else {
                                if (ret.all_list.length > 0){
                                    //concat() ÊñπÊ≥ïÁî®‰∫éËøûÊé•‰∏§‰∏™ÊàñÂ§ö‰∏™Êï∞ÁªÑ„ÄÇ
                                    vm.find_list = vm.find_list.concat(ret.all_list);
                                }
                            }
                        }
                    } else {
                        my_toast();
                    }
                });
            },

            //ÁßÅ‰ø°ËÅäÂ§©
            open_chat: function(){
                api.openWin({
                    name: 'chat',
                    url: 'chat.html',
                    pageParam: {
                        uid: vm.user_id,
                        nick: vm.my_nick,
                        img_url: vm.my_head,
                    }
                });
            },

            //ËØ¶ÊÉÖÈ°µ
            open_find_content: function (id_, is_good_, his_id_) {
                api.openWin({
                    name: 'find_content_win',
                    url: './find_content_win.html',
                    pageParam: {
                        moment_id: id_,
                        his_id: his_id_,
                    }
                });
            },


            //Êü•ÁúãÂõæÁâá
            open_img_big: function (list_, index_) {
                api.openWin({
                    name: 'open_img',
                    url: './open_img.html',
                    pageParam: {
                        img_list: list_,
                        img_index:index_,
                    }
                });
            },

            //Êí≠ÊîæÂΩïÈü≥
            paly_audio: function (voice_, id_) {
                vm.is_stop = true;
                vm.play_s = 'Êí≠Êîæ‰∏≠...';
                vm.true_id_voice = id_;

                //ÂÖà‰∏ãËΩΩ
                api.download({
                    url: qiniu_url + voice_,
                    report: true,
                    cache: true,
                    allowResume: true
                }, function (ret, err) {
                    if (ret.state === 1) {
                        //‰∏ãËΩΩÊàêÂäü ÂÜçÊí≠Êîæ
                        api.startPlay({
                            path: ret.savePath
                        }, function (ret, err) {
                            if (ret) {
                                vm.true_id_voice = 0;
                                api.toast({
                                    msg: 'Êí≠ÊîæÂÆåÊØï',
                                    duration: 1000,
                                    location: 'bottom'
                                });
                            } else {
                                vm.play_s = 'Êí≠ÊîæÈîôËØØ';
                            }
                        });
                    } else {
                        api.toast({
                            msg: 'Êí≠ÊîæÂá∫Èîô',
                            duration: 1000,
                            location: 'bottom'
                        });
                    }
                });
            },

            //ÂÅúÊ≠¢Êí≠ÊîæÂΩïÈü≥
            stop_voice: function () {
                api.stopPlay();
                vm.true_id_voice = 0;
                api.toast({
                    msg: 'Â∑≤ÂÅúÊ≠¢Êí≠Êîæ',
                    duration: 1000,
                    location: 'bottom'
                });
            },

            //ËßÜÈ¢ëÊí≠Êîæ
            play_video: function (video_) {
                api.openWin({
                    name: 'open_video',
                    url: './open_video.html',
                    pageParam: {
                        video_url: video_,
                        qiniu_url: qiniu_url,
                    }
                });
            }
        },

        //Êó∂Èó¥ËøáÊª§Âô®
        filters: {
            filter_d: function (d_) {
                if (d_ && d_.length > 5) {
                    value = d_.substring(0, 5);
                }
                return value;
            }
        },
    });


    // ÂÆûÁé∞‰∏ãÊãâÂà∑Êñ∞ÂäüËÉΩ
    function initRefresh() {
        api.setRefreshHeaderInfo({
            loadingImg: 'widget://image/fresh.png',
            bgColor: '#ccc',
            textColor: '#fff',
            textDown: '‰∏ãÊãâÂà∑Êñ∞...',
            textUp: 'Âò§Âò§Âò§ ÊîæÂºÄÊàë...'
        }, function (ret, err) {
            vm.skip = 0;
            vm.init(true);//ÂàùÂßãÂåñ ajaxÊï∞ÊçÆËØ∑Ê±Ç
            api.toast({
                msg: 'Â∑≤Âà∑Êñ∞',
                duration: 1000,
                location: 'bottom'
            });
        });
    }


    //ÂÖ≥Ê≥®
    function to_follow() {
        api.ajax({
            url: follow_me + '?user_id=' + $api.getStorage('uid') + '&his_id=' + vm.user_id,
            method: 'get',
            cache: 'true',
            timeout: 30,
            dataType: 'json',
            returnAll: false,
        }, function (ret, err) {
            if (ret) {
                if (ret.code === 200){
                    api.toast({
                        msg: 'ÂÖ≥Ê≥®ÊàêÂäüÔºÅ',
                        duration: 1000,
                        location: 'bottom'
                    });
                    //Âà∑Êñ∞È°µÈù¢
                    vm.skip = 0;
                    vm.init(true);//ÂàùÂßãÂåñ ajaxÊï∞ÊçÆËØ∑Ê±Ç
                }
            } else {
                my_toast();
            }
        });
    }


    //ÂèñÊ∂àÂÖ≥Ê≥®
    function off_follow() {
        api.confirm({
            title: 'ÊèêÁ§∫',
            msg: 'ÊÇ®Á°ÆÂÆöË¶ÅÂèñÊ∂àÂÖ≥Ê≥®ÂêóÔºü',
            buttons: ['Á°ÆÂÆö', 'ÂèñÊ∂à']
        }, function(ret, err) {
            if (ret.buttonIndex === 1){
                api.ajax({
                    url: cancel_follow + '?user_id=' + $api.getStorage('uid') + '&his_id=' + vm.user_id,
                    method: 'get',
                    cache: 'true',
                    timeout: 30,
                    dataType: 'json',
                    returnAll: false,
                }, function (ret, err) {
                    if (ret) {
                        if (ret.code === 200){
                            api.toast({
                                msg: 'Â∑≤ÂèñÊ∂àÂÖ≥Ê≥®ÔºÅ',
                                duration: 1000,
                                location: 'bottom'
                            });
                            //Âà∑Êñ∞È°µÈù¢
                            vm.skip = 0;
                            vm.init(true);//ÂàùÂßãÂåñ ajaxÊï∞ÊçÆËØ∑Ê±Ç
                        }
                    } else {
                        my_toast();
                    }
                });
            }
        });
    }


</script>
</html>
